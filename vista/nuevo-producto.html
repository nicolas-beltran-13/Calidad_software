<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Productos - Salsamentaria</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Barra de navegación Mejorada -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="../index.html" class="logo">
                    <i class="fas fa-store"></i>
                    Salsamentaria
                </a>
            </div>
            <div class="nav-right">
                <a href="login.html" class="nav-link">
                    <i class="fas fa-user"></i> Mi Cuenta
                </a>
                <a href="../index.html" class="nav-link">
                    <i class="fas fa-home"></i> Inicio
                </a>
            </div>
        </div>
    </nav>

    <!-- Botón toggle sidebar móvil -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="admin-container">
        <div class="sidebar" id="sidebar">
            <h3><i class="fas fa-tachometer-alt"></i> Panel de Administración</h3>
            <ul class="admin-menu">
                <li class="active"><a href="nuevo-producto.html"><i class="fas fa-plus"></i> Nuevo Producto</a></li>
                <li><a href="#"><i class="fas fa-list"></i> Lista de Productos</a></li>
                <li><a href="#"><i class="fas fa-chart-bar"></i> Estadísticas</a></li>
                <li><a href="#"><i class="fas fa-users"></i> Usuarios</a></li>
                <li><a href="#"><i class="fas fa-cog"></i> Configuración</a></li>
            </ul>
        </div>

        <div class="content-area">
            <!-- Breadcrumbs -->
            <nav class="breadcrumbs">
                <ul class="breadcrumb-list">
                    <li><a href="../index.html">Inicio</a></li>
                    <li><a href="#">Administración</a></li>
                    <li>Nuevo Producto</li>
                </ul>
            </nav>

            <div class="page-header">
                <h2><i class="fas fa-plus-circle"></i> Ingresar Nuevo Producto</h2>
                <p class="page-subtitle">Complete la información del producto para agregarlo al catálogo</p>
            </div>

            <!-- Mensajes de estado -->
            <div id="messages"></div>

            <form action="../Controlador/producto.php" method="POST" enctype="multipart/form-data" class="product-form" id="productForm">
                <!-- Información Básica -->
                <div class="form-section">
                    <h3><i class="fas fa-info-circle"></i> Información Básica</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <input type="text" id="nombre" name="nombre" placeholder=" " required>
                            <label for="nombre"><i class="fas fa-tag"></i> Nombre del Producto</label>
                        </div>

                        <div class="form-group">
                            <select id="categoria" name="categoria" required>
                                <option value="">Seleccione una categoría</option>
                                <option value="lacteos">Lácteos</option>
                                <option value="carnes">Carnes Frías</option>
                                <option value="bebidas">Bebidas</option>
                                <option value="panaderia">Panadería</option>
                                <option value="snacks">Snacks</option>
                                <option value="congelados">Congelados</option>
                            </select>
                            <label for="categoria"><i class="fas fa-folder"></i> Categoría</label>
                        </div>

                        <div class="form-group">
                            <input type="number" id="precio" name="precio" step="0.01" placeholder=" " required>
                            <label for="precio"><i class="fas fa-dollar-sign"></i> Precio (COP)</label>
                        </div>

                        <div class="form-group">
                            <input type="number" id="cantidad" name="cantidad" min="0" placeholder=" " required>
                            <label for="cantidad"><i class="fas fa-boxes"></i> Cantidad en Stock</label>
                        </div>
                    </div>
                </div>

                <!-- Descripción -->
                <div class="form-section">
                    <h3><i class="fas fa-align-left"></i> Descripción del Producto</h3>
                    <div class="form-group full-width">
                        <textarea id="descripcion" name="descripcion" rows="4" placeholder=" " required></textarea>
                        <label for="descripcion"><i class="fas fa-align-left"></i> Descripción detallada</label>
                    </div>
                </div>

                <!-- Imágenes -->
                <div class="form-section">
                    <h3><i class="fas fa-images"></i> Imágenes del Producto</h3>
                    <div class="form-group full-width">
                        <div class="file-upload-area" id="fileUploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">Arrastra y suelta las imágenes aquí</div>
                            <div class="upload-hint">o haz clic para seleccionar archivos</div>
                            <input type="file" id="foto" name="foto[]" accept="image/*" multiple required>
                        </div>
                        <div id="imagePreviewContainer" class="image-preview-container"></div>
                    </div>
                </div>

                <!-- Acciones -->
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="cancelForm()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-primary" id="submitBtn">
                        <i class="fas fa-save"></i> Guardar Producto
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Variables globales
        let selectedFiles = [];
        const maxFiles = 5;
        const maxFileSize = 5 * 1024 * 1024; // 5MB

        // Toggle sidebar móvil
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Cerrar sidebar al hacer clic fuera en móvil
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.querySelector('.sidebar-toggle');

            if (window.innerWidth <= 768 &&
                !sidebar.contains(e.target) &&
                !toggleBtn.contains(e.target)) {
                sidebar.classList.remove('open');
            }
        });

        // Sistema de subida de archivos mejorado
        const fileInput = document.getElementById('foto');
        const fileUploadArea = document.getElementById('fileUploadArea');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');

        // Eventos de drag and drop
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileUploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            fileUploadArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileUploadArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            fileUploadArea.classList.add('dragover');
        }

        function unhighlight(e) {
            fileUploadArea.classList.remove('dragover');
        }

        fileUploadArea.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFileSelect, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            [...files].forEach(file => {
                if (validateFile(file)) {
                    selectedFiles.push(file);
                    previewFile(file);
                }
            });
            updateFileInput();
        }

        function validateFile(file) {
            if (!file.type.startsWith('image/')) {
                showMessage('Solo se permiten archivos de imagen.', 'error');
                return false;
            }

            if (file.size > maxFileSize) {
                showMessage('El archivo es demasiado grande. Máximo 5MB.', 'error');
                return false;
            }

            if (selectedFiles.length >= maxFiles) {
                showMessage(`Máximo ${maxFiles} archivos permitidos.`, 'warning');
                return false;
            }

            return true;
        }

        function previewFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewItem = document.createElement('div');
                previewItem.className = 'image-preview-item';
                previewItem.innerHTML = `
                    <img src="${e.target.result}" alt="${file.name}">
                    <button type="button" class="remove-image" onclick="removeFile('${file.name}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                imagePreviewContainer.appendChild(previewItem);
            };
            reader.readAsDataURL(file);
        }

        function removeFile(fileName) {
            selectedFiles = selectedFiles.filter(file => file.name !== fileName);
            updatePreviews();
            updateFileInput();
        }

        function updatePreviews() {
            imagePreviewContainer.innerHTML = '';
            selectedFiles.forEach(file => previewFile(file));
        }

        function updateFileInput() {
            const dt = new DataTransfer();
            selectedFiles.forEach(file => dt.items.add(file));
            fileInput.files = dt.files;
        }

        // Validación del formulario mejorada
        document.getElementById('productForm').addEventListener('submit', function(e) {
            const form = this;
            const submitBtn = document.getElementById('submitBtn');

            // Validar precio
            const precio = parseFloat(document.getElementById('precio').value);
            if (precio <= 0) {
                e.preventDefault();
                showMessage('El precio debe ser mayor a 0.', 'error');
                document.getElementById('precio').focus();
                return false;
            }

            // Validar cantidad
            const cantidad = parseInt(document.getElementById('cantidad').value);
            if (cantidad < 0) {
                e.preventDefault();
                showMessage('La cantidad no puede ser negativa.', 'error');
                document.getElementById('cantidad').focus();
                return false;
            }

            // Validar nombre
            const nombre = document.getElementById('nombre').value.trim();
            if (nombre.length < 3) {
                e.preventDefault();
                showMessage('El nombre debe tener al menos 3 caracteres.', 'error');
                document.getElementById('nombre').focus();
                return false;
            }

            // Validar descripción
            const descripcion = document.getElementById('descripcion').value.trim();
            if (descripcion.length < 10) {
                e.preventDefault();
                showMessage('La descripción debe tener al menos 10 caracteres.', 'error');
                document.getElementById('descripcion').focus();
                return false;
            }

            // Validar imágenes
            if (selectedFiles.length === 0) {
                e.preventDefault();
                showMessage('Debe seleccionar al menos una imagen.', 'error');
                return false;
            }

            // Mostrar confirmación
            if (!confirm('¿Estás seguro de que deseas guardar este producto?')) {
                e.preventDefault();
                return false;
            }

            // Mostrar loading
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
        });

        // Cancelar formulario
        function cancelForm() {
            if (confirm('¿Estás seguro de que deseas cancelar? Los cambios no se guardarán.')) {
                window.location.href = '../index.html';
            }
        }

        // Sistema de mensajes
        function showMessage(message, type = 'info') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `
                <i class="fas fa-${getIconForType(type)}"></i>
                ${message}
                <button type="button" onclick="this.parentElement.remove()" style="float: right; background: none; border: none; color: inherit; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            messagesDiv.appendChild(messageDiv);

            // Auto-remover después de 5 segundos
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        function getIconForType(type) {
            switch (type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                default: return 'info-circle';
            }
        }

        // Tooltips para campos
        document.querySelectorAll('.form-group input, .form-group select, .form-group textarea').forEach(field => {
            field.addEventListener('focus', function() {
                const tooltip = this.getAttribute('data-tooltip');
                if (tooltip) {
                    showTooltip(this, tooltip);
                }
            });

            field.addEventListener('blur', function() {
                hideTooltip();
            });
        });

        function showTooltip(element, text) {
            const existingTooltip = document.querySelector('.tooltip-text');
            if (existingTooltip) existingTooltip.remove();

            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip-text';
            tooltip.textContent = text;

            element.parentElement.appendChild(tooltip);
        }

        function hideTooltip() {
            const tooltip = document.querySelector('.tooltip-text');
            if (tooltip) tooltip.remove();
        }

        // Formateo automático de precio
        document.getElementById('precio').addEventListener('input', function(e) {
            let value = e.target.value;
            if (value && !isNaN(value)) {
                e.target.value = parseFloat(value).toFixed(2);
            }
        });

        // Contador de caracteres para descripción
        document.getElementById('descripcion').addEventListener('input', function(e) {
            const maxLength = 500;
            const currentLength = e.target.value.length;

            if (currentLength > maxLength) {
                e.target.value = e.target.value.substring(0, maxLength);
                showMessage(`La descripción no puede exceder ${maxLength} caracteres.`, 'warning');
            }
        });

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            showMessage('Complete todos los campos requeridos para guardar el producto.', 'info');
        });
    </script>
</body>
</html>